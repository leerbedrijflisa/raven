<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Raven - A sane HTML Validator</title>
        <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
        <style>
            textarea.vert {
                resize: vertical;
            }

            .soft-hide {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- HTML Input -->
            <div id="slideHtmlInput">
                <!-- Basic HTML -->
                <div class="text-center">
                    <h1>Raven HTML Validator</h1>
                    <p class="lead">Paste your HTML below and get your hard work validated.</p>
                </div>
                <div class="form-group">
                    <textarea class="form-control vert" rows="10" id="htmlInput"></textarea>
                </div>
                
                <div class="clearfix"></div>

                <!-- Advanced Settings -->
                <div id="advancedInput" class="soft-hide">
                    <div class="text-center">
                        <h1>Advanced Settings</h1>
                        <p class="lead">Configure more complex settings for your validation.</p>
                    </div>
                    <div class="form-group">
                        <h2>Check URLs</h2>
                        <ul id="checkList">
                            <li>http://localhost:2746/api/check/CheckHtml</li>
                        </ul>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Add Check</label>
                        <div class="input-group">
                            <input class="form-control" type="url" placeholder="http://example.com/api/mycheck" id="checkInput"/>
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" id="checkAdd">Add</button>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Buttons -->
                <div class="btn-group btn-group-justified">
                    <a class="btn btn-primary btn-lg btn-block raven-btn-validate">Validate</a>
                    <a class="btn btn-default btn-lg btn-block raven-btn-advanced">Show Advanced Settings</a>
                </div>
            </div>
            
            <!-- Validation Results -->
            <div id="slideResult" class="soft-hide">
                <div class="text-center">
                    <h1 id="outputHeader">Validating...</h1>
                    <div id="outputProgress" class="progress progress-striped active">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>
                </div>
                <ul id="output"></ul>
                <a id="outputReturnButton" class="btn btn-default btn-lg btn-block raven-btn-return">Return to HTML</a>
            </div>
        </div>

        <script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            $(document).ready(function () {
                var apiUri = 'api/validator';
                var showingAdvanced = false;
                var animSpeed = 400;
                var activeSlide = $('#slideHtmlInput');

                function animateTo(slide) {
                    activeSlide.fadeOut(animSpeed, function() {
                        slide.fadeIn(animSpeed);
                    });
                    activeSlide = slide;
                }

                function resetResponse() {
                    $('#outputHeader').text("Validating...");
                    $('#outputProgress').show();
                    $('#outputReturnButton').hide();

                    $('#output').empty();
                }

                function displayResponse(data) {
                    $('#outputHeader').text("Validated");
                    $('#outputProgress').hide();
                    $('#outputReturnButton').show();

                    $('#output').empty();

                    // Data coming in is a JSON array
                    data.forEach(function (element, index, array) {
                        var item = $('<li>').text(element.Message);
                        $('#output').append(item);
                    });

                    // If there's no errors at all, add a message for that
                    if (data.length == 0) {
                        var item = $('<li>').text("No validation errors (hooray)!");
                        $('#output').append(item);
                    }
                }


                $('.raven-btn-html').on('click', function() {
                    animateTo($('#slideHtmlInput'));
                });


                $('.raven-btn-advanced').on('click', function() {
                    var panel = $('#advancedInput');
                    var buttons = $('.raven-btn-advanced');
                    if (showingAdvanced) {
                        buttons.text("Show Advanced Settings");
                        panel.slideUp(animSpeed);
                        showingAdvanced = false;
                    } else {
                        buttons.text("Hide Advanced Settings");
                        panel.slideDown(animSpeed);
                        showingAdvanced = true;
                    }
                });

                $('#checkAdd').on('click', function () {
                    var newItem = $('<li>');
                    newItem.text($('#checkInput').val());
                    $('#checkList').append(newItem);
                });

                $('.raven-btn-validate').on('click', function() {
                    resetResponse();
                    animateTo($('#slideResult'));

                    var data = { "Html": $('#htmlInput').val(), "CheckUrls": ["http://localhost:2746/api/check/CheckHtml"] };
                    $.post(apiUri + '/' + "validate", data)
                        .done(function (retData) {
                            displayResponse(retData);
                        })
                        .fail(function (jqXhr, textStatus, err) {
                            $('#output').text('Error: ' + err);
                        });
                });

                $('.raven-btn-return').on('click', function () {
                    animateTo($('#slideHtmlInput'));
                });
            });
        </script>
    </body>
</html>